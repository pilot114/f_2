# Как спроектировать новый сервис

## 1. Приемка ТЗ

- Сформировать список эндпоинтов (по макетам фронта)
- Сформировать список сущностей (используемые таблицы)

Можно сразу в коде, но поначалу рекомендую "программировать на бумаге".

| RPC метод       | описание                |
|-----------------|-------------------------|
| a.b.getFruits   | Получить список фруктов |
| a.b.createApple | Создать яблоко          |
| a.b.createPear  | Создать грушу           | 

| имя             | описание   | enum  |
|-----------------|------------|-------|
| test.apple      | яблоко     | false |
| test.pear       | груша      | false |
| test.fruit_type | тип фрукта | true  | 

Результат - понимание "а что вообще делать".
Также важно сразу определить приоритет - в каком порядке делать.
Каждый эндпоинт планируется как мини-задача в рамках общей задачи на бекенд (для себя).

## 2. Прототипирование

- Связи Entity (тоже табличкой, с указанием типа связи). Как правило, в документации уже есть ERM диаграмма как отправная точка.
- Репозитории
- Юзкейсы
- Предварительный формат данных апи (понять, где нужны DTO)

Результат - read-only прототип. Можно сделать draft MR для предварительного обсуждения

Существенную помощь при прототипировании может оказать команда генерации кода:

>    bin/console system:make

## 3. Проработка

- SQL запросы
- Сервисы (если нужны)
- Прогон линтеров, написание тестов (на "нетупые" юзкейсы, сущности)
- Уточнения апи
- MR

# Детали

### Взаимодействие с фронтом

На списке эндпоинтов можно строить различные взаимодействия.  
Например, полезно выставить приоритеты (что нужно раньше, что может подождать)

### Entity

- определяем, что уже есть и насколько можно переиспользовать (**и нужно ли**)
- заполняем нужные Column

[Подробнее про нашу ORM](http://192.168.6.29/portal/database/-/blob/main/docs/ORM.md)

Вот общие рекомендации, которые следует учитывать при проектировании сущности

- Не надо заранее создавать сеттеры, для заполнения данными обычно достаточно конструктора
- Не надо заранее создавать геттеры, нужно создавать их по мере необходимости
- Если нужно логгировать или выводить сущности в консоль - используйте __toString

### Использование SQL из документации от аналитиков

- копируем запрос из доки
- убираем лишнее (ненужные комментарии, алиасы, case, enums)
- обязательно добавляем TO_DATE() к датам чтобы избежать проблем с настройками сессии
- форматируем
- проверяем запрос, включая денормализацию
- оптимизируем по производительности
- обновляем доку
