# API для работы с файлами

## Общая информация

API предоставляет возможности для загрузки, получения, просмотра и удаления файлов.  
Все конечные точки используют базовый префикс `/api/v2/file`.

## Аутентификация, обработка ошибок

Соответствует основному апи, см. [Описание апи](./api.md)

## Авторизация

Work in progress (Планируется разграничение доступа по владельцам и коллекциям)

## Кэширование

Work in progress (Планируется выставление заголовков для HTTP кэша)

## Конечные точки API

### Загрузка файла

```
POST /api/v2/file/upload
```

Загружает новый файл в систему.

#### Параметры запроса

| Параметр    | Тип    | Обязательный | Описание                                      |
|-------------|--------|--------------|-----------------------------------------------|
| file        | File   | Да           | Файл для загрузки                             |
| collection  | String | Да           | Имя коллекции (каталога) для хранения файла   |

#### Пример

```
curl --location 'local.portal.com/api/v2/file/upload' \
--header 'Authorization: ••••••' \
--form 'file=@"/home/oleg/Загрузки/test.jpg"' \
--form 'collection="test"'
```

```json
{
  "result": {
    "id": 748291,
    "name": "test",
    "extension": "jpg",
    "userId": 4026,
    "lastEditedDate": null,
    "downloadUrl": "/api/v2/file/748291/download",
    "viewUrl": "/api/v2/file/748291/view",
    "collection": {
      "idInCollection": 1,
      "name": "test"
    }
  }
}
```

**downloadUrl** следует использовать для скачивания файла (Content-Disposition: attachment)  
**viewUrl** следует использовать для отображения файла в браузере (Content-Disposition: inline)

### Удаление файла

```
DELETE /api/v2/file/{fileId}/delete
```

Удаляет файл.

### Поиск файлов

```
GET /api/v2/file/search
```

Получает список файлов по заданным критериям.

#### Параметры запроса

| Параметр       | Тип    | Обязательный | Описание                                                 |
|----------------|--------|--------------|----------------------------------------------------------|
| ownerId        | String | Нет          | ID владельца файлов (если не указан, используется текущий пользователь) |
| collectionName | String | Нет          | Имя коллекции для фильтрации                             |

#### Пример ответа

```json
{
  "result": {
    "items": [
      {
        "id": 206941,
        "name": "kz",
        "extension": "png",
        "userId": 4026,
        "lastEditedDate": "2017-12-04T15:11:13+07:00",
        "downloadUrl": "/api/v2/file/206941/download",
        "viewUrl": "/api/v2/file/206941/view",
        "collection": {
          "idInCollection": 65483,
          "name": "task2"
        }
      },
      {
        "id": 223396,
        "name": "ui-status",
        "extension": "png",
        "userId": 4026,
        "lastEditedDate": "2018-04-16T14:27:07+07:00",
        "downloadUrl": "/api/v2/file/223396/download",
        "viewUrl": "/api/v2/file/223396/view",
        "collection": {
          "idInCollection": 70029,
          "name": "task2"
        }
      }
  ],
  "total": 2
  }
}
```

### Скачивание файла

```
GET /api/v2/file/{fileId}/download
```

Скачивает оригинальный файл.

#### Параметры пути

| Параметр | Тип    | Обязательный | Описание     |
|----------|--------|--------------|--------------|
| fileId   | Integer| Да           | ID файла     |

#### Ответ

Оригинальный файл с заголовками для скачивания.

### Просмотр файла

```
GET /api/v2/file/{fileId}/view/{resizeString?}
```

Возвращает файл для просмотра, с возможностью изменения размера для изображений.

#### Параметры пути

| Параметр     | Тип     | Обязательный | Описание                                          |
|--------------|---------|--------------|---------------------------------------------------|
| fileId       | Integer | Да           | ID файла                                          |
| resizeString | String  | Нет          | Строка параметров изменения размера (опционально) |

resizeString будет работать только на изображениях и в соответствии с настройками
ресайза для конкретных коллекций.

Формат:  
TYPE_WIDTH_HEIGHT (пример: fit_80_80)
- fit  - Пропорциональное изменение размера
- crop - Обрезка картинки по размеру от центра картинки

#### Ответ

Файл с заголовками для встроенного просмотра.

### Информация о файле

```
GET /api/v2/file/{fileId}/info
```

Получает информацию о файле.

#### Параметры пути

| Параметр | Тип    | Обязательный | Описание     |
|----------|--------|--------------|--------------|
| fileId   | Integer| Да           | ID файла     |

#### Пример ответа

```json
{
  "id": 223396,
  "name": "ui-status",
  "extension": "png",
  "userId": 4026,
  "lastEditedDate": "2018-04-16T14:27:07+07:00",
  "downloadUrl": "/api/v2/file/223396/download",
  "viewUrl": "/api/v2/file/223396/view",
  "collection": {
    "idInCollection": 70029,
    "name": "task2"
  }
}
```
